<div class="container-fluid mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Dashboard del Organizador</h2>
  </div>
  
  <!-- Formulario para Añadir/Editar Eventos -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header">
      <!-- El título del formulario cambia dinámicamente -->
      <h4 *ngIf="!editMode">Añadir Nuevo Evento</h4>
      <h4 *ngIf="editMode">Editar Evento: {{ eventModel.title }}</h4>
    </div>
    <div class="card-body">
      <!-- El formulario llama a onFormSubmit() al enviarse -->
      <form (ngSubmit)="onFormSubmit()">
        <!-- Campo oculto para guardar el ID cuando editamos -->
        <input type="hidden" [(ngModel)]="eventModel.id" name="id">
        
        <div class="mb-3">
          <label for="title" class="form-label">Título del Evento</label>
          <input id="title" type="text" class="form-control" [(ngModel)]="eventModel.title" name="title" required>
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Descripción</label>
          <textarea id="description" class="form-control" [(ngModel)]="eventModel.description" name="description" required></textarea>
        </div>
        <div class="mb-3">
          <label for="date" class="form-label">Fecha</label>
          <input id="date" type="date" class="form-control" [(ngModel)]="eventModel.date" name="date" required>
        </div>
        
        <!-- Los botones también cambian dinámicamente -->
        <button type="submit" class="btn btn-primary" *ngIf="!editMode">Guardar Evento</button>
        <button type="submit" class="btn btn-info" *ngIf="editMode">Actualizar Evento</button>
        <button type="button" class="btn btn-secondary ms-2" *ngIf="editMode" (click)="cancelEdit()">Cancelar</button>
      </form>
    </div>
  </div>

  <!-- Lista de Eventos -->
  <h3>Mis Eventos</h3>
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Título</th>
          <th>Fecha</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <!-- SPINNER DE CARGA -->
        <tr *ngIf="isLoading">
          <td colspan="3" class="text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2">Cargando eventos...</p>
          </td>
        </tr>
        
        <!-- LISTA DE EVENTOS (se muestra cuando isLoading es false) -->
        <tr *ngFor="let event of events">
          <td>{{ event.title }}</td>
          <td>{{ event.date | date: 'dd/MM/yyyy' }}</td> <!-- Usamos el pipe para formatear la fecha -->
          <td class="text-end">
            <button class="btn btn-sm btn-warning me-2" (click)="editEvent(event)">Editar</button>
            <button class="btn btn-sm btn-danger" (click)="deleteEvent(event.id)">Eliminar</button>
          </td>
        </tr>

        <!-- MENSAJE SI NO HAY EVENTOS -->
        <tr *ngIf="events.length === 0 && !isLoading">
          <td colspan="3" class="text-center py-4">No has creado ningún evento todavía. ¡Anímate a crear el primero!</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>